<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Markdown Studio</title>
    <style>
        :root {
            --bg-color: #f3f3f3;
            --toolbar-bg: #ffffff;
            --border-color: #d1d5db;
            --primary-color: #2563eb;
            --text-color: #1f2937;
            --editor-bg: #1e1e1e;
            --editor-text: #d4d4d4;
            --preview-bg: #ffffff;
            --handle-hover: #3b82f6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: var(--bg-color);
        }

        /* --- Toolbar --- */
        .toolbar {
            height: 50px;
            background: var(--toolbar-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 1rem;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .brand {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            color: var(--text-color);
        }

        button:hover {
            background: #f0f9ff;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        button.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        button.primary:hover {
            background: #1d4ed8;
        }

        /* --- Main Layout --- */
        .container {
            display: flex;
            flex: 1;
            height: calc(100vh - 50px);
            position: relative;
            overflow: hidden; /* Ensure content doesn't break layout */
        }

        /* Editor Section */
        .pane-editor {
            width: 50%; /* Initial width */
            background: var(--editor-bg);
            display: flex;
            flex-direction: column;
            min-width: 200px; /* Prevent it from disappearing */
            flex-shrink: 0;   /* CRITICAL: Prevents right side from squashing left side */
        }

        textarea {
            flex: 1;
            background: var(--editor-bg);
            color: var(--editor-text);
            border: none;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            width: 100%;
        }

        /* Resizer Handle */
        .resizer {
            width: 8px;
            background: #e5e7eb;
            cursor: col-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            z-index: 10;
            flex-shrink: 0; /* Prevent resizer from shrinking */
        }

        .resizer:hover, .resizer.active {
            background: var(--handle-hover);
        }

        .resizer-knob {
            width: 4px;
            height: 30px;
            background: #9ca3af;
            border-radius: 2px;
        }

        /* Preview Section */
        .pane-preview {
            flex: 1; /* Takes remaining space */
            background: var(--preview-bg);
            padding: 40px;
            overflow-y: auto;
            color: var(--text-color);
            min-width: 200px;
        }

        /* Markdown Styles (GitHub-like) */
        .markdown-body {
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .markdown-body h1, .markdown-body h2, .markdown-body h3 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            color: #111;
        }

        .markdown-body h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        .markdown-body h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        .markdown-body h3 { font-size: 1.25em; }
        
        .markdown-body p { margin-bottom: 16px; }
        
        .markdown-body ul, .markdown-body ol { padding-left: 2em; margin-bottom: 16px; }
        
        .markdown-body blockquote {
            padding: 0 1em;
            color: #6a737d;
            border-left: 0.25em solid #dfe2e5;
            margin: 0 0 16px 0;
        }

        .markdown-body pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            padding: 16px;
            overflow: auto;
            margin-bottom: 16px;
        }

        .markdown-body code {
            font-family: Consolas, monospace;
            background-color: rgba(27,31,35,0.05);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        .markdown-body pre code {
            background-color: transparent;
            padding: 0;
        }

        .markdown-body img {
            max-width: 100%;
            border-style: none;
        }
        
        .markdown-body a { color: #0366d6; text-decoration: none; }
        .markdown-body a:hover { text-decoration: underline; }
        .markdown-body hr { height: 0.25em; padding: 0; margin: 24px 0; background-color: #e1e4e8; border: 0; }
        .markdown-body table { border-spacing: 0; border-collapse: collapse; margin-bottom: 16px; width: 100%; }
        .markdown-body table th, .markdown-body table td { padding: 6px 13px; border: 1px solid #dfe2e5; }
        .markdown-body table tr:nth-child(2n) { background-color: #f6f8fa; }

        /* --- PRINT STYLES (Crucial for PDF Export) --- */
        @media print {
            body { 
                background: white; 
                height: auto; 
                overflow: visible; 
                display: block; 
            }
            .toolbar, .pane-editor, .resizer { 
                display: none !important; 
            }
            .container { 
                height: auto; 
                display: block; 
            }
            .pane-preview { 
                width: 100%; 
                padding: 0; 
                overflow: visible; 
                height: auto; 
            }
            .markdown-body {
                max-width: 100%;
                margin: 0;
            }
        }
    </style>
</head>
<body>

    <div class="toolbar">
        <div class="brand">
            <span>üìù</span> Markdown Studio
        </div>
        <div class="actions">
            <button onclick="toggleLayout()" id="layoutBtn">Toggle View</button>
            <button onclick="saveMarkdown()">Save .md</button>
            <button onclick="saveWord()">Save .doc</button>
            <button class="primary" onclick="window.print()">Save PDF</button>
        </div>
    </div>

    <div class="container" id="container">
        <div class="pane-editor" id="editorPane" style="width: 50%;">
            <textarea id="sourceArea" placeholder="# Start typing your markdown here...
            
Try some features:

- **Bold text** and *Italic text*
- [Links](https://example.com)
- > Blockquotes work too
- Code blocks:

```
console.log('Hello World');
```
"></textarea>
        </div>
        
        <div class="resizer" id="resizer">
            <div class="resizer-knob"></div>
        </div>

        <div class="pane-preview" id="previewPane">
            <div id="previewContent" class="markdown-body"></div>
        </div>
    </div>

<script>
    /**
     * --------------------------------------------------------------------------
     * 1. CUSTOM OFFLINE MARKDOWN PARSER
     * --------------------------------------------------------------------------
     * A lightweight regex-based parser to ensure functionality without internet.
     */
    function parseMarkdown(markdown) {
        let html = markdown;

        // Escape HTML characters to prevent simple XSS (basic protection)
        html = html.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

        // 1. Code Blocks (Handle first to preserve content)
        // Replaces ```code``` with placeholders to avoid formatting inside
        const codeBlocks = [];
        html = html.replace(/```([\s\S]*?)```/g, (match, code) => {
            codeBlocks.push(code);
            return `__CODE_BLOCK_${codeBlocks.length - 1}__`;
        });

        // 2. Headers
        html = html.replace(/^###### (.*$)/gm, '<h6>$1</h6>');
        html = html.replace(/^##### (.*$)/gm, '<h5>$1</h5>');
        html = html.replace(/^#### (.*$)/gm, '<h4>$1</h4>');
        html = html.replace(/^### (.*$)/gm, '<h3>$1</h3>');
        html = html.replace(/^## (.*$)/gm, '<h2>$1</h2>');
        html = html.replace(/^# (.*$)/gm, '<h1>$1</h1>');

        // 3. Blockquotes
        html = html.replace(/^\> (.*$)/gm, '<blockquote>$1</blockquote>');

        // 4. Horizontal Rule
        html = html.replace(/^-{3,}$/gm, '<hr>');

        // 5. Bold & Italic
        html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        html = html.replace(/__(.*?)__/g, '<strong>$1</strong>');
        html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
        html = html.replace(/_(.*?)_/g, '<em>$1</em>');

        // 6. Links & Images
        html = html.replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">');
        html = html.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');

        // 7. Inline Code
        html = html.replace(/`(.*?)`/g, '<code>$1</code>');

        // 8. Lists (Unordered) - A bit tricky with regex, doing a multi-pass approach
        // Wrap lines starting with - or * in <li>
        html = html.replace(/^\s*[-*]\s+(.*)$/gm, '<li>$1</li>');
        // Wrap adjacent <li> in <ul> (simple heuristic)
        html = html.replace(/(<li>.*<\/li>(\n|$))+/g, '<ul>$&</ul>');

        // 9. Lists (Ordered)
        html = html.replace(/^\s*\d+\.\s+(.*)$/gm, '<li>$1</li>');
        // Note: This regex groups mixed lists imperfectly but works for simple cases
        // To fix ordered list wrapping properly requires a state machine, 
        // but often browsers render <li> grouped nicely anyway. 
        // We will do a generic wrapper pass for remaining groups of <li> that aren't inside <ul>
        // (Skipped for simplicity in this regex-only version to maintain stability)

        // 10. Paragraphs (Split by double newline)
        // We split by double newlines that AREN'T inside HTML tags we just made
        // This is hard with regex. Simple approach:
        // Any text not starting with < is likely a paragraph.
        html = html.replace(/^(?!<)(.+)$/gm, '<p>$1</p>');

        // Restore Code Blocks
        html = html.replace(/__CODE_BLOCK_(\d+)__/g, (match, index) => {
            return `<pre><code>${codeBlocks[index]}</code></pre>`;
        });

        // Cleanup newlines
        html = html.replace(/\n/g, ''); // Minify slightly for rendering

        return html;
    }

    /**
     * --------------------------------------------------------------------------
     * 2. EDITOR LOGIC
     * --------------------------------------------------------------------------
     */
    const sourceArea = document.getElementById('sourceArea');
    const previewContent = document.getElementById('previewContent');

    function updatePreview() {
        const source = sourceArea.value;
        const html = parseMarkdown(source);
        previewContent.innerHTML = html;
    }

    // Initialize
    sourceArea.addEventListener('input', updatePreview);
    // Initial Render
    updatePreview();


    /**
     * --------------------------------------------------------------------------
     * 3. RESIZER LOGIC (Split Pane)
     * --------------------------------------------------------------------------
     */
    const resizer = document.getElementById('resizer');
    const editorPane = document.getElementById('editorPane');
    const container = document.getElementById('container');
    let isResizing = false;

    resizer.addEventListener('mousedown', (e) => {
        isResizing = true;
        resizer.classList.add('active');
        document.body.style.cursor = 'col-resize';
        // Prevent text selection during drag
        document.body.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;
        
        // Calculate percentage
        const containerWidth = container.offsetWidth;
        const newWidth = e.clientX;
        const percentage = (newWidth / containerWidth) * 100;

        // Limits (10% to 90%)
        if (percentage > 10 && percentage < 90) {
            editorPane.style.width = `${percentage}%`;
        }
    });

    document.addEventListener('mouseup', () => {
        isResizing = false;
        resizer.classList.remove('active');
        document.body.style.cursor = 'default';
        document.body.style.userSelect = 'auto';
    });


    /**
     * --------------------------------------------------------------------------
     * 4. FILE OPERATIONS (MD, DOC, PDF)
     * --------------------------------------------------------------------------
     */
    
    // Save as .md
    function saveMarkdown() {
        const text = sourceArea.value;
        const blob = new Blob([text], { type: "text/markdown" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "document.md";
        link.click();
        
        // Clean up
        setTimeout(() => URL.revokeObjectURL(link.href), 100);
    }

    // Save as .doc (MS Word)
    function saveWord() {
        const preHtml = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML to Word Document</title></head><body>";
        const postHtml = "</body></html>";
        
        // Get the rendered HTML
        const html = preHtml + document.getElementById('previewContent').innerHTML + postHtml;

        // Create a blob with proper MIME type for Word
        const blob = new Blob(['\ufeff', html], {
            type: 'application/msword'
        });
        
        const url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);
        
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "document.doc";
        link.click();
        
        setTimeout(() => URL.revokeObjectURL(link.href), 100);
    }

    // Toggle Layout (Edit / Split / Preview)
    let layoutState = 1; // 0: Edit Only, 1: Split, 2: Preview Only
    function toggleLayout() {
        layoutState = (layoutState + 1) % 3;
        const editor = document.getElementById('editorPane');
        const resizer = document.getElementById('resizer');
        const preview = document.getElementById('previewPane');

        if (layoutState === 0) {
            // Edit Only
            editor.style.width = '100%';
            editor.style.display = 'flex';
            resizer.style.display = 'none';
            preview.style.display = 'none';
        } else if (layoutState === 1) {
            // Split (Reset to 50% for consistency)
            editor.style.width = '50%';
            editor.style.display = 'flex';
            resizer.style.display = 'flex';
            preview.style.display = 'block';
        } else {
            // Preview Only
            editor.style.display = 'none';
            resizer.style.display = 'none';
            preview.style.display = 'block';
        }
    }

</script>
</body>
</html>
